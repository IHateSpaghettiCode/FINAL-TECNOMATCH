generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model roles {
  id       Int        @id @default(autoincrement())
  nombre   String     @unique(map: "nombre") @db.VarChar(50)
  usuarios usuarios[]
}

model usuarios {
  id_usuario           Int                    @id @default(autoincrement())
  nombre               String                 @db.VarChar(50)
  apellido             String                 @db.VarChar(50)
  nombre_completo      String?                @ignore @db.VarChar(255)
  nombre_usuario       String                 @db.VarChar(50)
  correo               String                 @unique(map: "correo") @db.VarChar(100)
  password             String                 @db.VarChar(255)
  telefono             String?                @db.VarChar(20)
  fecha_nacimiento     DateTime?              @db.Date
  rol_id               Int?                   @default(2)
  estado               Int?                   @default(1) @db.TinyInt
  profileImage         String?                @db.LongText
  intentos_fallidos    Int?                   @default(0)
  created_at           DateTime               @default(now()) @db.Timestamp(0)
  updated_at           DateTime               @default(now()) @updatedAt @db.Timestamp(0)
  confirmation_token   String?                @db.VarChar(255)
  confirmed            Boolean?               @default(false)
  auditoria_usuarios   auditoria_usuarios[]
  carreras_vistas      carreras_vistas[]
  resultados_test      resultados_test[]
  universidades_vistas universidades_vistas[]
  roles                roles?                 @relation(fields: [rol_id], references: [id], map: "usuarios_ibfk_1")

  @@index([rol_id], map: "rol_id")
}

model universidades {
  id_universidad       Int                    @id @default(autoincrement())
  nombre_universidad   String                 @db.VarChar(100)
  ciudad               String                 @db.VarChar(50)
  snies                String?                @unique(map: "snies") @db.VarChar(20)
  carreras             carreras[]
  recomendaciones      recomendaciones[]
  universidades_vistas universidades_vistas[]
}

model carreras {
  id_carrera          Int               @id @default(autoincrement())
  nombre_carrera      String            @db.VarChar(100)
  slug                String?           @unique(map: "slug") @db.VarChar(255)
  descripcion         String?           @db.Text
  objetivo            String?           @db.Text
  duracion            String?           @db.VarChar(50)
  estado              carreras_estado?  @default(activa)
  fecha_creacion      DateTime          @default(now()) @db.Timestamp(0)
  fecha_actualizacion DateTime          @default(now()) @db.Timestamp(0)
  id_universidad      Int
  imagen              String?
  modalidad           String?
  costo               String?
  universidades       universidades     @relation(fields: [id_universidad], references: [id_universidad], onDelete: Cascade, map: "carreras_ibfk_1")
  carreras_vistas     carreras_vistas[]
  recomendaciones     recomendaciones[]

  @@index([id_universidad], map: "id_universidad")
}

model perfilespsicologicos {
  id_perfil       Int               @id @default(autoincrement())
  nombre_perfil   String            @db.VarChar(100)
  descripcion     String?           @db.Text
  resultados_test resultados_test[]
}

model resultados_test {
  id_resultado         Int                  @id @default(autoincrement())
  id_usuario           Int
  id_perfil            Int
  fecha                DateTime?            @default(now()) @db.DateTime(0)
  recomendaciones      recomendaciones[]
  usuarios             usuarios             @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, map: "resultados_test_ibfk_1")
  perfilespsicologicos perfilespsicologicos @relation(fields: [id_perfil], references: [id_perfil], map: "resultados_test_ibfk_2")

  @@index([id_perfil], map: "id_perfil")
  @@index([id_usuario], map: "id_usuario")
}

model recomendaciones {
  id_recomendacion Int             @id @default(autoincrement())
  id_resultado     Int
  id_carrera       Int
  id_universidad   Int
  tipo             String?         @default("perfil") @db.VarChar(50)
  fecha_generacion DateTime?       @default(now()) @db.DateTime(0)
  resultados_test  resultados_test @relation(fields: [id_resultado], references: [id_resultado], onDelete: Cascade, map: "recomendaciones_ibfk_1")
  carreras         carreras        @relation(fields: [id_carrera], references: [id_carrera], onDelete: Cascade, map: "recomendaciones_ibfk_2")
  universidades    universidades   @relation(fields: [id_universidad], references: [id_universidad], onDelete: Cascade, map: "recomendaciones_ibfk_3")

  @@index([id_carrera], map: "id_carrera")
  @@index([id_resultado], map: "id_resultado")
  @@index([id_universidad], map: "id_universidad")
}

model auditoria_usuarios {
  id_auditoria Int      @id @default(autoincrement())
  id_usuario   Int
  accion       String   @db.VarChar(50)
  fecha        DateTime @default(now()) @db.Timestamp(0)
  usuarios     usuarios @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, map: "auditoria_usuarios_ibfk_1")

  @@index([id_usuario], map: "id_usuario")
}

model universidades_vistas {
  id             Int           @id @default(autoincrement())
  id_usuario     Int
  id_universidad Int
  fecha          DateTime      @default(now()) @db.Timestamp(0)
  usuarios       usuarios      @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, map: "universidades_vistas_ibfk_1")
  universidades  universidades @relation(fields: [id_universidad], references: [id_universidad], onDelete: Cascade, map: "universidades_vistas_ibfk_2")

  @@index([id_universidad], map: "id_universidad")
  @@index([id_usuario], map: "id_usuario")
}

model carreras_vistas {
  id         Int      @id @default(autoincrement())
  id_usuario Int
  id_carrera Int
  fecha      DateTime @default(now()) @db.Timestamp(0)
  usuarios   usuarios @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, map: "carreras_vistas_ibfk_1")
  carreras   carreras @relation(fields: [id_carrera], references: [id_carrera], onDelete: Cascade, map: "carreras_vistas_ibfk_2")

  @@index([id_carrera], map: "id_carrera")
  @@index([id_usuario], map: "id_usuario")
}

enum carreras_estado {
  activa
  inactiva
}
